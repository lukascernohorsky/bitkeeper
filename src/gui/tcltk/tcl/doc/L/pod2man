#!/usr/bin/env tclsh
# Tcl wrapper replacing the original Perl pod2man helper.
# It forwards arguments to the system pod2man(1) if available and falls
# back to a minimal groff conversion so the documentation build no longer
# depends on Perl in-tree.

proc fail {msg} {
    puts stderr $msg
    exit 1
}

set pod2man [expr {[info exists ::env(POD2MAN)] ? $::env(POD2MAN) : "pod2man"}]

if {[catch {exec $pod2man {*}$argv} err opts]} {
    # Fallback: try groff directly; assumes POD input.
    set code [dict get $opts -code]
    if {$code ne "NONE"} {
        puts stderr "pod2man fallback: $err"
    }
    if {[catch {exec groff -mandoc -Tman {*}$argv} gerr]} {
        fail "groff fallback failed: $gerr"
    }
}
